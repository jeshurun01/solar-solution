# ü§ù Guide de Contribution - Solar Solution

Merci de votre int√©r√™t pour contribuer √† Solar Solution ! Ce document vous guidera √† travers le processus de contribution.

---

## üìã Table des Mati√®res

1. [Code de Conduite](#code-de-conduite)
2. [Comment Contribuer](#comment-contribuer)
3. [Configuration de l'Environnement](#configuration-de-lenvironnement)
4. [Standards de Code](#standards-de-code)
5. [Tests](#tests)
6. [Processus de Pull Request](#processus-de-pull-request)
7. [Convention de Commit](#convention-de-commit)
8. [Architecture du Projet](#architecture-du-projet)

---

## üåü Code de Conduite

### Nos Engagements

Ce projet adh√®re aux principes suivants :
- **Respect** : Traiter tous les contributeurs avec respect et dignit√©
- **Inclusivit√©** : Cr√©er un environnement accueillant pour tous
- **Collaboration** : Encourager le travail d'√©quipe et l'entraide
- **Qualit√©** : Maintenir des standards √©lev√©s de code et documentation

### Comportements Inacceptables

- Langage ou images inappropri√©s
- Attaques personnelles ou trolling
- Harc√®lement public ou priv√©
- Publication d'informations priv√©es sans permission

---

## üöÄ Comment Contribuer

### Types de Contributions

Nous accueillons diff√©rents types de contributions :

#### 1. üêõ Signaler des Bugs

Cr√©ez une issue avec :
- **Titre clair** : R√©sum√© du probl√®me
- **Description** : √âtapes pour reproduire
- **Environnement** : OS, Python version, navigateur
- **Comportement attendu vs actuel**
- **Captures d'√©cran** si applicable

**Template Bug Report:**
```markdown
**Description du Bug**
Description claire et concise du bug.

**√âtapes pour Reproduire**
1. Aller √† '...'
2. Cliquer sur '...'
3. Voir l'erreur

**Comportement Attendu**
Ce qui devrait se passer.

**Comportement Actuel**
Ce qui se passe r√©ellement.

**Environnement**
- OS: [e.g., Ubuntu 22.04]
- Python: [e.g., 3.13]
- Streamlit: [e.g., 1.45.1]
- Navigateur: [e.g., Chrome 120]

**Captures d'√âcran**
Si applicable, ajoutez des captures d'√©cran.
```

#### 2. üí° Proposer des Fonctionnalit√©s

Cr√©ez une issue avec :
- **Cas d'usage** : Probl√®me que √ßa r√©sout
- **Solution propos√©e** : Comment √ßa devrait fonctionner
- **Alternatives** : Autres approches consid√©r√©es
- **Mockups/Wireframes** si applicable

**Template Feature Request:**
```markdown
**Probl√®me √† R√©soudre**
Quel probl√®me cette fonctionnalit√© r√©sout-elle ?

**Solution Propos√©e**
Description claire de la fonctionnalit√©.

**Alternatives Consid√©r√©es**
Autres solutions envisag√©es.

**B√©n√©fices**
- B√©n√©fice 1
- B√©n√©fice 2

**Complexit√© Estim√©e**
[Facile / Moyenne / Difficile]
```

#### 3. üìù Am√©liorer la Documentation

- Corriger des typos
- Clarifier des sections confuses
- Ajouter des exemples
- Traduire dans d'autres langues

#### 4. üîß Contribuer du Code

Voir sections ci-dessous pour les d√©tails.

---

## üõ†Ô∏è Configuration de l'Environnement

### Pr√©requis

- **Python 3.13+**
- **uv** (gestionnaire de paquets rapide)
- **Git**

### Installation

1. **Forker le Repository**
   ```bash
   # Sur GitHub, cliquer sur "Fork"
   ```

2. **Cloner votre Fork**
   ```bash
   git clone https://github.com/VOTRE-USERNAME/solar-solution.git
   cd solar-solution
   ```

3. **Configurer le Remote Upstream**
   ```bash
   git remote add upstream https://github.com/jeshurun01/solar-solution.git
   ```

4. **Installer les D√©pendances**
   ```bash
   # Installation avec uv (recommand√©)
   uv pip install -e ".[dev]"
   
   # Ou avec pip
   pip install -e ".[dev]"
   ```

5. **V√©rifier l'Installation**
   ```bash
   # Lancer les tests
   pytest tests/ -v
   
   # Lancer l'application
   streamlit run main.py
   ```

### Structure des Branches

- `main` : Code stable en production
- `develop` : Branche de d√©veloppement
- `feature/*` : Nouvelles fonctionnalit√©s
- `bugfix/*` : Corrections de bugs
- `hotfix/*` : Corrections urgentes
- `docs/*` : Documentation

---

## üìê Standards de Code

### Style Python

Nous suivons **PEP 8** avec quelques adaptations :

#### Longueur de Ligne
```python
# Maximum 100 caract√®res (pas 79)
# OK
result = calculate_battery_needed(daily_energy, voltage, capacity, autonomy, depth)

# √Ä √©viter (trop long)
result = calculate_battery_needed(daily_energy_consumption_wh, battery_voltage_v, battery_capacity_ah, autonomy_days, discharge_depth_percentage)
```

#### Nommage

```python
# Classes : PascalCase
class Equipment:
    pass

class EquipmentFactory:
    pass

# Fonctions/Variables : snake_case
def calculate_battery_needed():
    total_energy = 0
    num_batteries = 0

# Constantes : UPPER_CASE
MAX_VOLTAGE_DROP = 3.0
COPPER_RESISTIVITY = 0.01724

# Priv√© : pr√©fixe underscore
def _internal_helper():
    pass

class MyClass:
    def __init__(self):
        self._private_var = 0
```

#### Imports

```python
# Standard library
import json
from pathlib import Path
from datetime import datetime

# Third-party
import streamlit as st
import pandas as pd
import plotly.graph_objects as go

# Local
from models import Equipment, EquipmentFactory
from utils import battery_needed, panel_needed
```

### Type Hints

**Obligatoire** pour toutes les fonctions publiques :

```python
from typing import Optional, Dict, List

def calculate_roi(
    total_cost: float,
    daily_energy_kwh: float,
    electricity_price_per_kwh: float
) -> Dict[str, float]:
    """Calculate return on investment."""
    # Implementation
    pass

def get_equipment_by_name(name: str) -> Optional[Equipment]:
    """Get equipment by name or None if not found."""
    # Implementation
    pass
```

### Docstrings

**Google Style** obligatoire :

```python
def calculate_cable_section(
    current: float,
    length: float,
    voltage: int,
    max_drop_percent: float = 3.0
) -> Dict[str, float]:
    """
    Calculate cable section based on voltage drop requirements.
    
    Uses the formula: S = (2 √ó œÅ √ó I √ó L) / ŒîV
    where:
    - S = cable cross-section (mm¬≤)
    - œÅ = resistivity of copper at 20¬∞C (0.01724 Œ©¬∑mm¬≤/m)
    - I = current (A)
    - L = cable length one-way (m)
    - ŒîV = maximum acceptable voltage drop (V)
    
    Args:
        current: Current in Amperes
        length: Cable length in meters (one-way distance)
        voltage: System voltage in Volts
        max_drop_percent: Maximum acceptable voltage drop percentage (default 3%)
        
    Returns:
        dict: Cable specifications with keys:
            - cable_section: Selected cable section in mm¬≤
            - actual_drop_volts: Actual voltage drop in Volts
            - actual_drop_percent: Actual voltage drop percentage
            - fuse_rating: Recommended fuse rating in Amperes
            - current: Operating current in Amperes
            
    Examples:
        >>> specs = calculate_cable_section(50.0, 10.0, 12, 3.0)
        >>> print(f"Cable: {specs['cable_section']} mm¬≤")
        Cable: 35.0 mm¬≤
    """
    # Implementation
    pass
```

**Sections requises:**
- Description br√®ve (1 ligne)
- Description d√©taill√©e (optionnelle)
- Args : Tous les param√®tres
- Returns : Type et structure du retour
- Raises : Exceptions lev√©es (si applicable)
- Examples : Au moins un exemple (recommand√©)

### Commentaires

```python
# Bon : Expliquer le POURQUOI
# Calculate with 25% safety margin to handle peak loads
recommended_current = nominal_current * 1.25

# Mauvais : Expliquer le QUOI (√©vident)
# Multiply by 1.25
recommended_current = nominal_current * 1.25

# Formules complexes : documenter
# Formula: n = (E √ó A) / (V √ó C √ó DoD)
# Where:
#   E = Daily energy (Wh)
#   A = Autonomy days
#   V = Battery voltage (V)
#   C = Battery capacity (Ah)
#   DoD = Depth of discharge (0-1)
num_batteries = math.ceil((energy * autonomy) / (voltage * capacity * dod))
```

### Gestion d'Erreurs

```python
# Sp√©cifique, pas g√©n√©rique
try:
    config = load_configuration(name)
except FileNotFoundError:
    logger.error(f"Configuration '{name}' not found")
    raise
except json.JSONDecodeError as e:
    logger.error(f"Invalid JSON in configuration: {e}")
    raise ValueError(f"Malformed configuration file: {name}")

# √âviter les except g√©n√©riques
try:
    # ...
except Exception:  # ‚ùå Trop large
    pass
```

---

## üß™ Tests

### √âcriture de Tests

**Chaque fonctionnalit√© DOIT avoir des tests.**

#### Structure des Tests

```python
"""
Unit tests for XYZ module.

Tests cover:
- Feature 1
- Feature 2
- Edge cases
"""

import pytest
from module import function_to_test


class TestFeatureName:
    """Test cases for FeatureName"""
    
    def test_basic_case(self):
        """Test basic functionality"""
        # Arrange
        input_data = 100
        
        # Act
        result = function_to_test(input_data)
        
        # Assert
        assert result == expected_value
    
    def test_edge_case_zero(self):
        """Test with zero input"""
        result = function_to_test(0)
        assert result == 0
    
    def test_invalid_input_raises_error(self):
        """Test that invalid input raises appropriate error"""
        with pytest.raises(ValueError):
            function_to_test(-1)
```

#### Nommage des Tests

```python
# Pattern : test_<what>_<condition>_<expected>

def test_battery_needed_basic():
    """Test basic battery calculation"""
    pass

def test_battery_needed_zero_energy_returns_zero():
    """Test with zero energy consumption"""
    pass

def test_add_equipment_duplicate_name_raises_error():
    """Test that duplicate equipment raises ValueError"""
    pass
```

#### Assertions

```python
# Comparaisons exactes
assert result == expected_value
assert equipment.name == "Laptop"

# Comparaisons approximatives (float)
assert pytest.approx(result, 0.01) == 9.13

# Collections
assert len(equipments) == 3
assert "Laptop" in equipment_names

# Exceptions
with pytest.raises(ValueError) as exc_info:
    factory.add_equipment("Duplicate", 100, 2.0)
assert "already exists" in str(exc_info.value)

# Bool√©ens
assert factory.is_empty()
assert not equipment.is_active()
```

### Ex√©cution des Tests

```bash
# Tous les tests
pytest tests/ -v

# Tests sp√©cifiques
pytest tests/test_models.py -v
pytest tests/test_models.py::TestEquipment -v
pytest tests/test_models.py::TestEquipment::test_creation -v

# Avec couverture
pytest tests/ --cov=models --cov=utils --cov-report=html

# Mode watch (re-run on file change)
pytest-watch tests/

# Parall√®le (plus rapide)
pytest tests/ -n auto
```

### Couverture de Code

**Objectif : 80%+ de couverture**

```bash
# G√©n√©rer rapport
pytest tests/ --cov=models --cov=utils --cov-report=html

# Ouvrir rapport
open htmlcov/index.html  # macOS
xdg-open htmlcov/index.html  # Linux
```

**Lignes √† exclure de la couverture:**
```python
# pragma: no cover - pour code non testable
if TYPE_CHECKING:  # pragma: no cover
    from models import Equipment

def debug_only_function():  # pragma: no cover
    """Function used only for debugging"""
    pass
```

---

## üîÑ Processus de Pull Request

### Avant de Cr√©er une PR

1. **Cr√©er une branche**
   ```bash
   git checkout -b feature/ma-nouvelle-fonctionnalite
   ```

2. **Faire des commits atomiques**
   ```bash
   git add fichier1.py
   git commit -m "feat: add battery temperature compensation"
   
   git add test_fichier1.py
   git commit -m "test: add tests for temperature compensation"
   ```

3. **Synchroniser avec upstream**
   ```bash
   git fetch upstream
   git rebase upstream/main
   ```

4. **Ex√©cuter tous les tests**
   ```bash
   pytest tests/ -v
   ```

5. **V√©rifier le style**
   ```bash
   # Optionnel : utiliser black, flake8, mypy
   black .
   flake8 models/ utils/
   mypy models/ utils/
   ```

### Cr√©er la Pull Request

1. **Pousser votre branche**
   ```bash
   git push origin feature/ma-nouvelle-fonctionnalite
   ```

2. **Ouvrir une PR sur GitHub**
   - Titre clair et descriptif
   - Description d√©taill√©e (voir template ci-dessous)
   - Lier les issues concern√©es

**Template Pull Request:**
```markdown
## Description
Br√®ve description des changements.

## Type de Changement
- [ ] üêõ Bug fix (changement non-breaking qui corrige un probl√®me)
- [ ] ‚ú® New feature (changement non-breaking qui ajoute une fonctionnalit√©)
- [ ] üí• Breaking change (correction ou fonctionnalit√© qui casse la compatibilit√©)
- [ ] üìù Documentation (changements de documentation uniquement)
- [ ] ‚ôªÔ∏è Refactoring (changement de code sans modification de fonctionnalit√©)
- [ ] ‚ö° Performance (am√©lioration des performances)
- [ ] ‚úÖ Tests (ajout ou correction de tests)

## Comment Tester
1. √âtape 1
2. √âtape 2
3. R√©sultat attendu

## Checklist
- [ ] Mon code suit les standards du projet
- [ ] J'ai comment√© mon code, particuli√®rement les parties complexes
- [ ] J'ai mis √† jour la documentation
- [ ] Mes changements ne g√©n√®rent pas de nouveaux warnings
- [ ] J'ai ajout√© des tests qui prouvent que ma correction/fonctionnalit√© marche
- [ ] Les tests unitaires passent localement
- [ ] Les d√©pendances sont √† jour dans pyproject.toml

## Issues Li√©es
Closes #123
Related to #456

## Captures d'√âcran (si applicable)
```

### Review Process

1. **Automated Checks** (CI/CD)
   - Tests unitaires
   - Couverture de code
   - Linting
   - Type checking

2. **Code Review**
   - Au moins 1 approbation requise
   - R√©pondre aux commentaires
   - Faire les changements demand√©s

3. **Merge**
   - Squash & merge (commits propres)
   - Delete branch apr√®s merge

---

## üìù Convention de Commit

Nous utilisons **Conventional Commits** :

### Format

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Types

- `feat`: Nouvelle fonctionnalit√©
- `fix`: Correction de bug
- `docs`: Documentation uniquement
- `style`: Formatage, points-virgules, etc. (pas de changement de code)
- `refactor`: Refactoring (ni fix ni feat)
- `perf`: Am√©lioration des performances
- `test`: Ajout ou correction de tests
- `chore`: Maintenance (d√©pendances, config, etc.)
- `ci`: CI/CD (GitHub Actions, etc.)
- `build`: Syst√®me de build (pip, uv, etc.)
- `revert`: Revert d'un commit pr√©c√©dent

### Scopes (optionnels)

- `models`: Mod√®les de donn√©es
- `utils`: Utilitaires
- `ui`: Interface utilisateur
- `tests`: Tests
- `docs`: Documentation
- `i18n`: Internationalisation

### Exemples

```bash
# Feature
git commit -m "feat(models): add temperature compensation for batteries"

# Bug fix
git commit -m "fix(utils): correct voltage drop calculation in cables"

# Documentation
git commit -m "docs(readme): add installation instructions for Windows"

# Refactoring
git commit -m "refactor(utils): extract cable calculation to separate function"

# Tests
git commit -m "test(models): add tests for hourly consumption profile"

# Breaking change
git commit -m "feat(models)!: change Equipment constructor signature

BREAKING CHANGE: Equipment now requires start_hour parameter"

# Multiple scopes
git commit -m "feat(models,utils): add battery aging calculations"
```

### Body et Footer

```bash
git commit -m "feat(models): add battery temperature compensation

Temperature affects battery capacity and should be accounted for
in sizing calculations. This adds a temperature parameter with
default value of 25¬∞C.

Implements the Arrhenius equation for capacity correction:
C_t = C_25 √ó exp(k √ó (T - 25))

Closes #123
Refs #456"
```

---

## üèóÔ∏è Architecture du Projet

### Structure des Dossiers

```
solar_solution/
‚îú‚îÄ‚îÄ main.py                 # Application Streamlit principale
‚îú‚îÄ‚îÄ models/                 # Mod√®les de donn√©es
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ equipment.py        # Equipment, EquipmentFactory
‚îú‚îÄ‚îÄ utils/                  # Fonctions utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ calculations.py     # Calculs (batteries, panneaux, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ charts.py          # Graphiques Plotly
‚îÇ   ‚îú‚îÄ‚îÄ storage.py         # Sauvegarde/chargement
‚îÇ   ‚îî‚îÄ‚îÄ translations.py    # Gestion des langues
‚îú‚îÄ‚îÄ tests/                 # Tests unitaires
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_models.py
‚îÇ   ‚îî‚îÄ‚îÄ test_calculations.py
‚îú‚îÄ‚îÄ locals/                # Fichiers de traduction
‚îÇ   ‚îú‚îÄ‚îÄ en.json
‚îÇ   ‚îî‚îÄ‚îÄ fr.json
‚îú‚îÄ‚îÄ saved_configs/         # Configurations sauvegard√©es (gitignored)
‚îú‚îÄ‚îÄ equipment_library.json # Biblioth√®que d'√©quipements
‚îú‚îÄ‚îÄ pyproject.toml        # Configuration du projet
‚îú‚îÄ‚îÄ pytest.ini            # Configuration pytest
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ CONTRIBUTING.md       # Ce fichier
‚îú‚îÄ‚îÄ ACTION_PLAN.md        # Plan de d√©veloppement
‚îî‚îÄ‚îÄ .gitignore
```

### Principes Architecturaux

1. **Separation of Concerns**
   - Models : Logique m√©tier
   - Utils : Fonctions pures
   - Main : UI et orchestration

2. **Single Responsibility**
   - Chaque module a une responsabilit√© unique
   - Fonctions courtes et focalis√©es

3. **Dependency Injection**
   - Passer les d√©pendances explicitement
   - √âviter les variables globales

4. **Testabilit√©**
   - Fonctions pures autant que possible
   - Mocking facile

### Ajouter un Nouveau Module

1. **Cr√©er le fichier**
   ```bash
   touch utils/new_feature.py
   ```

2. **Ajouter docstring de module**
   ```python
   """
   Description of the module.
   
   This module provides...
   """
   ```

3. **Impl√©menter avec tests**
   ```bash
   touch tests/test_new_feature.py
   ```

4. **Exporter dans __init__.py**
   ```python
   # utils/__init__.py
   from .new_feature import my_function
   
   __all__ = [..., "my_function"]
   ```

5. **Documenter**
   - Ajouter dans README.md
   - Mettre √† jour TECHNICAL.md

---

## üìö Ressources

### Documentation

- [README.md](README.md) - Vue d'ensemble du projet
- [ACTION_PLAN.md](ACTION_PLAN.md) - Roadmap et progression
- [PHASE4_PROGRESS.md](PHASE4_PROGRESS.md) - D√©tails Phase 4
- [Python Type Hints](https://docs.python.org/3/library/typing.html)
- [Google Python Style Guide](https://google.github.io/styleguide/pyguide.html)
- [Conventional Commits](https://www.conventionalcommits.org/)

### Outils Utiles

- **Formatter:** [black](https://github.com/psf/black)
- **Linter:** [flake8](https://flake8.pycqa.org/)
- **Type Checker:** [mypy](http://mypy-lang.org/)
- **Test Runner:** [pytest](https://pytest.org/)
- **Coverage:** [pytest-cov](https://pytest-cov.readthedocs.io/)

### Contact

- **Issues:** [GitHub Issues](https://github.com/jeshurun01/solar-solution/issues)
- **Discussions:** [GitHub Discussions](https://github.com/jeshurun01/solar-solution/discussions)
- **Email:** [maintainer email]

---

## üôè Remerciements

Merci √† tous les contributeurs qui rendent ce projet possible !

### Hall of Fame

Consultez [CONTRIBUTORS.md](CONTRIBUTORS.md) pour la liste compl√®te des contributeurs.

---

## üìÑ Licence

En contribuant, vous acceptez que vos contributions soient sous la m√™me licence que le projet (MIT License).

---

**Bon code ! üöÄ**

*Derni√®re mise √† jour : Octobre 2025*
